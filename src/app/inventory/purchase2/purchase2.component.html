<div class="container-fluid mt-1 py-1" style="height: 100%;">
  <div
    class="eas-border-radius-0 bg-primary inner-header text-light nav-wrapper"
  >
    <div class="flex-row-back">
      <a
        class="nav-item-back"
        style="cursor: pointer"
        (click)="location.back()"
      >
        <i class="fa-solid fa-arrow-left"></i
      ></a>
      <h6 class="text-right my-2 p-2">{{branchName }} | Add New Purchase</h6>
    </div>
    <div class="flex-row" style="gap: 5px">
      <button class="btn btn-labeled btn-light border-0 my-2">
        <span class="btn-label"> </span>
        Statement
      </button>
      <button class="btn btn-labeled btn-light border-0 my-2" (click)="Save()">
        <span class="btn-label">
          <i class="fa-solid fa-floppy-disk"></i>
        </span>
        {{ this.purchase.pMid ? "Update" : "Save" }}
      </button>
      <button
        class="btn btn-labeled btn-light border-0 my-2"
        (click)="printVoucher()"
      >
        <span class="btn-label">
          <i class="fa-solid fa-floppy-disk"></i>
        </span>
        Print View
      </button>
    </div>
  </div>
  <div class="mt-3">
    <div class="  d-flex ">
      <div class="col-sm-9">
        <div class=" border-0  px-3 py-1 h-100">
          <div class="row">
            <div class="col-sm-12">
              <div class="row">
                <div class="col-md-2">
                  <label for="" class="form-label">Date</label>
                  <input
                    type="date"
                    class="form-control"
                    [(ngModel)]="eDate"
                    style="height: 32px; margin-bottom: 0"
                  />
                </div>
                <div class="col-md-2">
                  <label for="" class="form-label">Bill No.</label>
                  <input
                    type="text"
                    class="form-control"
                    [(ngModel)]="purchase.billNo"
                    style="height: 32px; margin-bottom: 0"
                  />
                </div>
                <div class="col-md-4" *ngIf="sharedService.globalsalesman">
                  <label for="" class="form-label">Salesman</label>
                  <ng-select
                    [items]="saleManArr"
                    bindLabel="saleMan"
                    bindValue="sAccId"
                    [(ngModel)]="purchase.agentID"
                    (change)="onChangeSaleMan($event)"
                    required
                  ></ng-select>
                </div>
                <div class="col-md-2" *ngIf="sharedService.globalpandi ">
                  <label for="" class="form-label">Pandi</label>
                  <input
                    type="text"
                    class="form-control"
                    style="height: 32px; margin-bottom: 0"
                    [(ngModel)]="purchase.pandi"
                  />
                </div>
                <div class="col-md-2" *ngIf="sharedService.globalbuilty">
                  <label for="" class="form-label">Builty No.</label>
                  <input
                    type="text"
                    class="form-control"
                    style="height: 32px; margin-bottom: 0"
                    [(ngModel)]="purchase.biltyNo"
                  />
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-4">
                  <label for="floatingInputGrid" class="form-label"
                    >Party</label
                  >
                  <ng-select
                  [items]="partyArr"
                  bindLabel="customerName"
                  bindValue="customerID"
                  [(ngModel)]="purchase.sAccID"
                  (change)="changeParty($event)"
                  required
                >
                </ng-select>
                </div>
                <div class="col-md-4">
                  <label for="" class="form-label">Remarks as cash Party</label>
                  <input
                    type="text"
                    class="form-control"
                    style="height: 32px; margin-bottom: 0"
                  />
                </div>
                <div class="col-md-2">
                  <label for="" class="form-label">Phone No.</label>
                  <input
                    type="text"
                    class="form-control"
                    style="height: 32px; margin-bottom: 0"
                  />
                </div>
                <div class="col-md-2" >
                  <label for="" class="form-label">Credit Limit</label>
                  <input
                    type="text"
                    class="form-control"
                    style="height: 32px; margin-bottom: 0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-3 p-1 mt-2">
       <div class="row mb-2">
            <div class="col-md-3">
              <label for="balance" class="form-label">Balance</label>
            </div>
            <div class="col-md-9">
              <input
              type="text"
              id="payable"
              value="{{ payable }}"
              class="form-control text-center"
              disabled
            />
            </div>
          </div>
          <div class="row mb-2">
            <div class="col-md-3">
              <label for="lsr" class="form-label">L.P.R</label>
            </div>
            <div class="col-md-9">
              <input
                type="text"
                id="lpr"
                disabled
                [(ngModel)]="lpr"
                class="form-control text-center"
              />
            </div>
          </div>
          <div class="row mb-2">
            <div class="col-md-3">
              <label for="lsr" class="form-label">Stock:</label>
            </div>
            <div class="col-md-9">
              <input
                type="text"
                id="lsr"
                disabled
                [(ngModel)]="sBal"
                class="form-control text-center"
              />
            </div>
          </div>
          <div class="row mb-1">
            <div class="col-md-3">
              <label for="lsr" class="form-label">Profit:</label>
            </div>
            <div class="col-md-9">
              <input
                type="text"
                id="lsr"
                disabled
                [(ngModel)]="iProfit"
                class="form-control text-center"
              />
            </div>
          </div>

         
      
      </div>
      
    </div>
    <div class="col-md-12  bg-primary  p-3"></div>

    <div class="col-md-12   p-3">
      <div class="d-flex">
        <div class="col-md-3 col-sm-12" style="margin-top: 3px">
          <label class="form-label fw-bold">Item</label>
          <ng-select
                    [items]="itemsArr"
                    bindLabel="itemDescription"
                    bindValue="itemID"
                    [(ngModel)]="_pSub.itemID"
                    (change)="changeItem($event)"
                    required
                    [searchFn]="customSearchFn"
                    #select
                  >
                  </ng-select>
        </div>

        <div class="col-md-5 col-sm-12 ">
          <div class="row no-gutters g-0">
            <div class="col-md-2 col-sm-6 text-center">
              <div class="form-group">
                <label class="form-label fw-bold">Unit</label>
                <input
                  type="text"
                  class="form-control text-center"
                  [(ngModel)]="_pSub.measureUnit"
                  disabled
                  style="
                    height: 32px !important;
                    
                  "
                />
              </div>
            </div>
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Packet</label>
                <input
                  type="number"
                  class="form-control text-center"
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                  [(ngModel)]="_pSub.packet"
                  (keyup)="Amt($event)"
                />
              </div>
            </div>
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Packet Qty</label>
                <input
                  type="number"
                  class="form-control text-center"
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                  [(ngModel)]="_pSub.pktQty"
                  (keyup)="Amt($event)"
                />
              </div>
            </div>
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Qty</label>
                <input
                  type="number"
                  class="form-control text-center"
                  [(ngModel)]="_pSub.qty"
                  disabled
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                  disabled
                />
              </div>
            </div>

            <div class="col-md-2 col-sm-6 text-center mt-1">
              <label class="form-label fw-bold">Rate</label>
              <input
                type="number"
                class="form-control text-center"
                [(ngModel)]="_pSub.purchaseRate"
                style="
                  height: 32px !important;
                  margin-bottom: 0 !important;
                "
                (keyup)="Amt($event)"
              />
            </div>
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Discount %</label>
                <input
                  type="number"
                  class="form-control text-center"
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                   (keyup)="Amt($event)"
                  [(ngModel)]="_pSub.disPer"
                />
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4 col-sm-12 p-0">
          <div class="row no-gutters g-1">
            
            
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Discount Rs</label>
                <input
                  type="number"
                  class="form-control text-center"
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                   (keyup)="Amt($event)"
                  [(ngModel)]="_pSub.disRS"
                />
              </div>
            </div>
            <div class="col-md-2 col-sm-6">
              <div class="form-group text-center">
                <label class="form-label fw-bold">Amount</label>
                <input
                  type="number"
                  class="form-control text-center"
                  style="
                    height: 32px !important;
                    margin-bottom: 0 !important;
                  "
                  [(ngModel)]="_pSub.amount"
                  disabled
                />
              </div>
            </div>
           
            <div class="col-md-3 col-sm-6  mt-2" *ngIf="sharedService.globalgodown">
              <label class="form-label fw-bold">Godown</label>
              <ng-select
                  [items]="goArr"
                  bindValue="cId"
                  bindLabel="goName"
                  [(ngModel)]="_pSub.n2"
                  (change)="onChageGodown($event)"
                  
                  >
                  <!-- (change)="onChangeGodown($event)" -->
                </ng-select>
            </div>
            <div class="col-md-2  d-flex flex-column col-sm-6 text-center mt-3">
              <div class="d-flex flex-column justify-content-center">
                <div class="form-check me-3 flex-row">
                  <input
                    class=""
                    type="radio"
                    name="pType"
                    id="purchase"
                    
                    [value]="ST[0].pTypeId"
                    (change)="changeType($event)"
                  />
                  <label class="form-check-label fs-2" for="purchase"
                    >Purchase</label
                  >
                </div>
                <div
                  class="form-check flex-row mb-3"
                  style="margin-right: 25px"
                >
                  <input
                    class=""
                    type="radio"
                    name="pType"
                    id="return"
                    
                    [value]="ST[1].pTypeId"
                    (change)="changeType($event)"
                  />
                  <label class="form-check-label fs-2" for="return"
                    >Return</label
                  >
                </div>
              </div>
            </div>
           
            <div class="col-md-2 h-100 col-sm-12 mt-md-4 float-md-end mt-2">
              <button
                class="btn "
                (click)="addLine()"
                style="
                  height: 33px !important;
                  width: 70%;
                  float: inline-end;
                  margin-top: 1px;
                  background-color: #4AAE1C;
                  color: white;
                "
              >
                ADD
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row shadow p-3" style="height: 530px;" >
      <div class="col-md-9 d-flex flex-column justify-content-between">
         <div
        class="table-responsive mt-2 col-xl-12"
        style="max-height: 48vh; overflow-y: auto"
      >
        <table class="table table-bordered">
          <thead>
            <tr class="text-center">
              <th  style="width: 10%">Bar Code</th>
              <th  style="width: 10%">Item Name</th>
              <th  style="width: 10%">Packet</th>
              <th  style="width: 10%">Packet Qty</th>
              <th  style="width: 10%">Qty</th>
              <th  style="width: 10%">Rate</th>
              <th  style="width: 10%">Dis%</th>
              <th style="width: 10%">Dis Rs.</th>
              <th  style="width: 10%">Amount</th>
              
              <th  style="width: 10%">Godown</th>
              <th  style="width: 10%">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let a of purchase.purchasesDetail">
              <td  style="width: 10%">{{ a.barcode }}</td>
              <td  style="width: 10%">{{ a.itemDescription }}</td>
              <td  style="width: 10%">{{ a.packet }}</td>
              <td  style="width: 10%">{{ a.pktQty }}</td>
              <td  style="width: 10%">{{ a.qty }}</td>
              <td  style="width: 10%">{{ a.purchaseRate }}</td>
              <td  style="width: 10%">{{ a.disPer }} %</td>
              <td  style="width: 10%">{{a.disRS }} </td>
            
              <td  style="width: 10%">{{ a.amount }}</td>
                <td style="width: 10%;" *ngIf="sharedService.globalgodown">
              {{a.txt3}}
              </td>

              <td class="text-right">
                <a class="text-primary mx-2" (click)="editLine(a)">
                  <i class="fa-regular fa-pen-to-square"></i>
                </a>
                <a class="text-danger mx-2" (click)="DeleteLine(a)">
                  <i class="fa-regular fa-trash-can"></i>
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <footer>
          <div
            class="d-flex justify-content-center col-md-12 p-3 text-center border gap-4 mt-3"
          >
            <div class="row mb-2 align-items-center">
              <div class="col-md-5">
                <label for="balance" class="form-label fw-bold"
                  >Purchase Packet</label
                >
              </div>
              <div class="col-md-9">
                <input
                  type="text"
                 
                  class="form-control text-center"
                  disabled
                />
              </div>
            </div>
      
            <div class="row mb-2 d-flex align-items-center">
              <div class="col-md-5">
                <label for="lsr" class="form-label fw-bold">Purchase Qty</label>
              </div>
              <div class="col-md-9">
                <input
                  type="text"
                  
                  disabled
                  class="form-control text-center"
                />
              </div>
            </div>
      
            <div class="row mb-2 align-items-center">
              <div class="col-md-5">
                <label for="lsr" class="form-label fw-bold">Return Packet</label>
              </div>
              <div class="col-md-9">
                <input
                  type="text"
                 
                  disabled
                  class="form-control text-center"
                />
              </div>
            </div>
      
            <div class="row mb-1 align-items-center">
              <div class="col-md-4">
                <label for="lsr" class="form-label fw-bold">Return Qty</label>
              </div>
              <div class="col-md-9">
                <input
                  type="text"
                 
                  disabled
                  class="form-control text-center"
                />
              </div>
            </div>
      
            <!-- Other grid elements here -->
          </div>
        </footer>
      </div>
    </div>
      <div class="col-md-3 border"> <div class="row h-100">
        <div class="col-xl-12">
          <div class="d-flex align-items-center p-2">
            <div class="row mb-3">
              <div class="col-xl-12 col-md-12">
                <div class="form-group">
                  <label for="" class="form-label"
                    >Total Purchase Amount</label
                  >
                  <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="purchase.gSale"
                  disabled
                />
                </div>
              </div>
              <div class="col-xl-12 mt-2 col-md-12">
                <div class="form-group">
                  <label for="" class="form-label"
                  
                    >Total return Amount</label
                  >
                  <input
                        type="number"
                        class="form-control"
                        [(ngModel)]="purchase.sReturn"
                        disabled
                      />
                </div>
              </div>
              <div class="col-xl-12 mt-2 col-md-12">
                <div class="form-group">
                  <label for="" class="form-label">Discount </label>
                  <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="purchase.discountUser"
                  (keyup)="cashReceived($event)"
                />
                </div>
              </div>
              <div class="col-xl-12 mt-2 col-md-12">
                <div class="form-group">
                  <label for="" class="form-label">Cash Paid</label>
                  <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="purchase.cashPay"
                  (keyup)="cashReceived($event)"
                />
                </div>
              </div>

              <div class="col-xl-12 mt-2 col-md-12">
                <div class="form-group">
                  <label for="" class="form-label">Net Bill</label>
                  <input
                  type="number"
                  class="form-control"
                  [(ngModel)]="netBill"
                  disabled
                />
                </div>
              </div>
              <!-- <div class="d-flex justify-content-end">
                <button
                  class="btn btn-labeled btn-success border-0 m-2"
                  (click)="Save()"
                >
                  <span class="btn-label p-2">
                    <i class="fa-solid fa-floppy-disk"></i> </span
                  >Save
                </button>
              </div> -->
            </div>
          </div>
        </div>
      </div></div>
    </div>
    
  </div>

</div>
<!-- ================================= -->



<!--  ==================================-->


<!-- ============================ -->
